<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8">
    <meta content="ie=edge" http-equiv="x-ua-compatible">
    <title>Đề xuất đồ uống - Cửa hàng đồ uống Rooks</title>
    <meta content="" name="description">
    <meta content="width=device-width, initial-scale=1" name="viewport">

    <!-- Favicons -->
    <link rel="shortcut icon" th:href="@{/images/favicon.ico}">
    <link rel="apple-touch-icon" th:href="@{/images/icon.png}">

    <!-- Google font (font-family: 'Roboto', sans-serif; Poppins ; Satisfy) -->
    <link rel="stylesheet" th:href="@{/css/user/open_sans.css}">
    <link rel="stylesheet" th:href="@{/css/user/poppins.css}">
    <link rel="stylesheet" th:href="@{/css/user/roboto.css}">

    <!-- Stylesheets -->
    <link rel="stylesheet" th:href="@{/css/user/bootstrap.min.css}">

    <!-- Plugins css -->
    <link rel="stylesheet" th:href="@{/css/user/font-awesome.min.css}">
    <link rel="stylesheet" th:href="@{/css/user/bicon.min.css}">
    <link rel="stylesheet" th:href="@{/css/user/pe-icon-7-stroke.css}">
    <link rel="stylesheet" th:href="@{/css/user/slick.min.css}">
    <link rel="stylesheet" th:href="@{/css/user/fakeloader.css}">
    <link rel="stylesheet" th:href="@{/css/user/nivo-slider.css}">
    <link rel="stylesheet" th:href="@{/css/user/nivo-preview-2.css}">
    <link rel="stylesheet" th:href="@{/css/user/owl.carousel.min.css}">
    <link rel="stylesheet" th:href="@{/css/user/owl.theme.default.min.css}">
    <link rel="stylesheet" th:href="@{/css/user/material-design-iconic-font.min.css}">
    <link rel="stylesheet" th:href="@{/css/user/animation.css}">
    <link rel="stylesheet" th:href="@{/css/user/fancybox.css}">
    <link rel="stylesheet" th:href="@{/css/user/mainmenu.css}">
    <link rel="stylesheet" th:href="@{/css/user/fotorama.css}">
    <link rel="stylesheet" th:href="@{/css/user/jquery-ui.min.css}">
    <link rel="stylesheet" th:href="@{/css/user/lightbox.css}">
    <link rel="stylesheet" th:href="@{/css/user/style.css}">
    <!-- Cusom css -->
    <link rel="stylesheet" th:href="@{/css/user/custom.css}">

    <!-- Modernizer js -->
    <script th:src="@{/js/user/vendor/modernizr-3.5.0.min.js}"></script>

    <style>
        .ft__logo a img {
            max-width: 20%;
        }

        .prod {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .product_img {
            height: 300px;
            overflow: hidden;
            display: block;
        }

        .product_img img {
            height: 100%;
            width: auto !important;
        }

        .title-container {
            height: 60px;
        }
    </style>
</head>

<body>
<!-- Main wrapper -->
<div class="wrapper" id="wrapper">
    <!-- Header -->
    <header th:replace="~{user/fragments/header :: header}"></header>
    <!-- //Header -->
    <!-- Start Search Popup -->
    <div th:replace="user/fragments/search_popup :: search_popup"></div>
    <!-- End Search Popup -->

    <!-- Start Recommendation Area -->
    <section class="wn__product__area brown--color pt--80 pb--30">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="section__title text-center">
                        <h2 class="title__be--2" th:text="${title}">Đề xuất cho bạn</h2>
                        <p>Dựa trên sở thích và lịch sử tương tác của bạn</p>
                    </div>
                </div>
            </div>
            <!-- Start Single Tab Content -->
            <div class="furniture--4 border--round arrows_style owl-carousel owl-theme row mt--50">
                <!-- Start Single Product -->
                <div class="product product__style--3" th:each="drink : ${recommendedDrinks}">
                    <div class="col-lg-3 col-md-4 col-sm-6 col-12">
                        <div class="product__thumb">
                            <a class="first__img" th:href="@{/shop/product/__${drink.id}__}">
                                <img style="width: 263px; height: 420px" th:src="${drink.coverImage}" alt="product image">
                            </a>
                            <div class="hot__box">
                                <span class="hot-label">ĐỀ XUẤT</span>
                            </div>
                        </div>
                        <div class="product__content content--center">
                            <h4><a th:href="@{/shop/product/__${drink.id}__}" th:text="${drink.title}"></a></h4>
                            <ul class="prize d-flex">
                                <li th:text="${#numbers.formatDecimal(__${(drink.salePrice)}__, 0, 'POINT', 0, 'POINT')} + ' VND'"></li>
                                <li class="old_prize" th:text="${#numbers.formatDecimal(__${(drink.originalPrice)}__, 0, 'POINT', 0, 'POINT')} + ' VND'"></li>
                            </ul>
                            <div class="action">
                                <div class="actions_inner">
                                    <ul class="add_to_links">
                                        <li><a class="cart" th:onclick="'addToCart(' + ${drink.id} + ')'"><i class="bi bi-shopping-bag4"></i></a></li>
                                        <li><a class="wishlist" th:onclick="'addToWishlist(' + ${drink.id} + ')'"><i class="bi bi-shopping-cart-full"></i></a></li>
                                        <li><a data-toggle="modal" th:onclick="'openModal(event, ' + ${drink.id} + ')'" title="Quick View" class="quickview modal-view detail-link"><i class="bi bi-search"></i></a></li>
                                    </ul>
                                </div>
                            </div>
                            <div class="product__hover--content">
                                <ul class="rating d-flex">
                                    <li class="on"><i class="fa fa-star-o"></i></li>
                                    <li class="on"><i class="fa fa-star-o"></i></li>
                                    <li class="on"><i class="fa fa-star-o"></i></li>
                                    <li><i class="fa fa-star-o"></i></li>
                                    <li><i class="fa fa-star-o"></i></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- End Single Product -->
            </div>
            <!-- End Single Tab Content -->
        </div>
    </section>
    <!-- End Recommendation Area -->

    <!-- Footer Area -->
    <footer th:replace="user/fragments/footer :: footer"></footer>
    <!-- //Footer Area -->
</div>
<!-- //Main wrapper -->

<!-- JS Files -->
<script th:src="@{/js/user/vendor/jquery-3.2.1.min.js}"></script>
<script th:src="@{/js/user/popper.min.js}"></script>
<script th:src="@{/js/user/bootstrap.min.js}"></script>
<script th:src="@{/js/user/plugins.js}"></script>
<script th:src="@{/js/user/active.js}"></script>

<script type="text/javascript">
    function addToCart(productId) {
        var data = JSON.stringify({"productId": productId, "quantity": 1});

        $.ajax({
            type: "POST",
            url: "/cart/add-to-cart",
            contentType: "application/json",
            data: data,
            success: function (data) {
                if (data === "ok") {
                    alert("Thêm sản phẩm vào giỏ thành công!");
                    updateCartQuantity();
                } else {
                    alert("Bạn cần đăng nhập trước");
                    window.location.href = "/login";
                }
            },
            error: function () {
                alert("Lỗi thêm sản phẩm vào giỏ hàng");
            }
        });
    }

    function updateCartQuantity() {
        $.ajax({
            type: "GET",
            url: "/cart/cart-item-count",
            success: function (data) {
                $("#cart-quantity").text(data);
            },
            error: function () {
                console.log("Lỗi cập nhật giỏ hàng");
            }
        });
    }

    function addToWishlist(productId) {
        $.ajax({
            type: "POST",
            url: "/wishlist/add",
            data: {
                drinkId: productId
            },
            success: function (response) {
                if (response === "ok") {
                    alert("Đã thêm vào danh sách yêu thích !")
                } else {
                    alert("Bạn cần đăng nhập trước");
                    window.location.href = "/login";
                }
            },
            error: function (xhr, status, error) {
                alert("Đã có lỗi : " + error);
            }
        });
    }
</script>
</body>
</html>
